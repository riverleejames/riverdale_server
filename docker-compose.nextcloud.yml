services:
  # Nextcloud AIO - All-in-One Nextcloud deployment
  # The mastercontainer manages all Nextcloud containers automatically
  nextcloud-aio-mastercontainer:
    image: nextcloud/all-in-one:latest
    container_name: nextcloud-aio-mastercontainer
    restart: unless-stopped
    init: true
    ports:
      # AIO interface (admin panel) - access via IP only
      - "${NEXTCLOUD_AIO_PORT:-8081}:8080"
      # NOTE: No Apache port exposed - Traefik will connect to nextcloud-aio-apache container
    volumes:
      # Where all Nextcloud data will be stored
      - nextcloud_aio_mastercontainer:/mnt/docker-aio-config
      # Mount the docker socket (required for AIO to manage containers)
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      # Timezone - Note: AIO recommends UTC but we'll set it anyway
      - TZ=${TZ}
      # DO NOT set APACHE_PORT when using reverse proxy mode
      # Skip domain validation - set to true for local domains
      - SKIP_DOMAIN_VALIDATION=true
      # Optional: Set a specific Nextcloud datadir location
      # - NEXTCLOUD_DATADIR=${NEXTCLOUD_DATADIR}
      # Optional: Backup location
      # - NEXTCLOUD_BACKUP_DIR=${NEXTCLOUD_BACKUP_DIR}
      # Optional: Mount additional directories (comma-separated)
      # - NEXTCLOUD_MOUNT=${NEXTCLOUD_MOUNT}
    networks:
      - riverdale_network

networks:
  riverdale_network:
    external: true

volumes:
  nextcloud_aio_mastercontainer:
    name: nextcloud_aio_mastercontainer
